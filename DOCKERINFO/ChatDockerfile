# Use Ubuntu 22.04 as the base image
FROM ubuntu:22.04

# Set environment variables
ENV DEBIAN_FRONTEND=noninteractive \
    USER=root \
    DISPLAY=:1

# Update package lists
RUN apt-get update && apt-get install -y \
    curl \
    gnupg \
    lsb-release \
    sudo \
    x11vnc \
    xvfb \
    xfce4 \
    xfce4-terminal \
    supervisor \
    dbus-x11 \
    tigervnc-standalone-server \
    tigervnc-xorg-extension \
    websockify \
    xterm \
    && rm -rf /var/lib/apt/lists/*

RUN apt-get update && apt-get install -y \
    novnc \
    fluxbox \
    && rm -rf /var/lib/apt/lists/*

RUN apt-get update && apt-get install -y colord upower xfce4-settings xfce4-panel

RUN apt-get install gedit -y


# Add ROS 2 sources and install ROS 2 Humble
RUN apt-get update && apt-get install -y \
    software-properties-common \
    && add-apt-repository universe \
    && curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key | apt-key add - \
    && echo "deb http://packages.ros.org/ros2/ubuntu $(lsb_release -cs) main" | tee /etc/apt/sources.list.d/ros2.list \
    && apt-get update && apt-get install -y \
    ros-humble-desktop 

RUN apt install ros-dev-tools -y
RUN sudo apt install ros-dev-tools -y
RUN apt install -y build-essential cmake git gnupg lsb-release wget 
RUN    sh -c 'echo "deb http://packages.osrfoundation.org/gazebo/ubuntu-stable `lsb_release -cs` main" > /etc/apt/sources.list.d/gazebo-stable.list' 
RUN  wget http://packages.osrfoundation.org/gazebo.key -O - |  apt-key add - 
RUN apt-get update 
RUN git clone https://github.com/ignitionrobotics/ign-gazebo 
RUN    apt -y install \
    $(sort -u $(find . -iname 'packages-'`lsb_release -cs`'.apt' -o -iname 'packages.apt' | tr '\n' ' '))

#RUN cd ign-gazebo
#RUN mkdir build
#RUN cd build
#RUN cmake ../
#RUN make


# Set up ROS 2 environment
RUN echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc

# Copy the entrypoint script to the container
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

#############################################
############## NaoQi Libraries ##############
#############################################
ARG ROS_DISTRO=humble
ENV ROS_DISTRO=${ROS_DISTRO}

# install basic dependencies
RUN apt-get update -y && apt-get install -y git python3-vcstool

# install naoqi driver libraries
RUN apt-get install -y ros-${ROS_DISTRO}-naoqi-libqi \
  ros-${ROS_DISTRO}-naoqi-libqicore ros-${ROS_DISTRO}-naoqi-bridge-msgs \
  ros-${ROS_DISTRO}-pepper-meshes \
  ros-${ROS_DISTRO}-nao-meshes \
  ros-${ROS_DISTRO}-naoqi-driver


# If you want to communicate with this docker
# you need to use the same id
RUN echo "export ROS_DOMAIN_ID=42" >> ~/.bashrc


# Start the container with our script
ENTRYPOINT ["/entrypoint.sh"]
